@model List<artistry_Web.ViewModels.MuseumVM>

@{ string search = "";}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<link href="~/assets/css/icons/icomoon/styles.css" rel="stylesheet" type="text/css">
<script>
    var map;
    function initMap(a, b) {
        if (a != null && b != null) {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: a, lng: b },
                zoom: 16
            });
            var marker = new google.maps.Marker({
                position: { lat: a, lng: b }, map: map
            });
        }
    }
</script>
@*<script src="https://maps.googleapis.com/maps/api/js?key=11111111111111111111111111111111111111111&callback=initMap" async defer></script>*@
<div class="body-wrapper">
    <div class="body-innerwrapper">
        <div id="sp-header-sticky-wrapper" class="sticky-wrapper is-sticky" style="height: 70px;width:100%;">
            <header id="sp-header" style="position: fixed; top: 0px;width:100%;background-color:#333;">
                <div class="container">
                    <div class="row" style="position: relative;">
                        <div id="sp-logo" class="col-xs-8 col-sm-3 col-md-3">
                            <div class="sp-column">
                                <div class="logo" style="margin-left:0px;">
                                    <a asp-controller="Home" asp-action="Index">
                                        <img class="sp-default-logo" src="~/assets/images/Logo3.png" style="margin-top:3px;width:150px;height:50px;">
                                        <img class="sp-retina-logo" src="~/assets/images/Logo3.png" alt="LT Museum" width="250" height="50">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div id="sp-menu" class="col-xs-4 col-sm-9 col-md-9" style="position: static;">
                            <div class="sp-column ">
                                <div class="sp-megamenu-wrapper">
                                    <ul class="sp-megamenu-parent menu-slide-down hidden-sm hidden-xs">
                                        <li class="sp-menu-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
                                        <li class="sp-menu-item"><a asp-controller="Museum" asp-action="Index">Museums</a>
                                        <li class="sp-menu-item current-item active"><a asp-controller="Artwork" asp-action="Index">Artworks</a>
                                        <li class="sp-menu-item"><a asp-controller="Artist" asp-action="Index">Artists</a></li>
                                        <li class="sp-menu-item"><a asp-controller="News" asp-action="Index">News</a></li>
                                        <li class="sp-menu-item"><a asp-controller="Autentification" asp-action="Index">Login</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
        </div>
        <section id="sp-page-title">
            <div class="row">
                <div id="sp-title" class="col-sm-12 col-md-12">
                    <div class="sp-column ">
                        <div class="sp-page-title">
                            <div class="container">
                                <h2>Artworks</h2>
                                <ol class="breadcrumb">
                                    <li><a asp-controller="Home" asp-action="Index" class="pathway">Home</a></li>
                                    <li class="active">Artworks</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="sp-main-body">
            <div class="container">
                <div class="row">
                    <div id="sp-component" class="col-sm-12 col-md-12">
                        <div class="sp-column ">
                            <div id="system-message-container">
                            </div>
                            <div class="portfolio-list portfolio-list" data-columns="4" data-gutter-width="10" data-overlay_effect="none" data-hoverdir_easing="ease" data-hoverdir_speed="300" data-hoverdir_hover_delay="0" data-hoverdir_inverse="0">
                                <form style="display:inline;" method="get" id="location-form" onclick="geocode();">
                                    <div class="input-group  input-field" style="margin-left:20px;width:100%;">
                                        <div class="row" style="margin-top:20px;">
                                            <div class="col-md-3">
                                                <input asp-for="@search" type="search" id="location-input" class="form-control" placeholder="Search.." style="float:left;border-radius:5px;" />
                                            </div>
                                            <div class="col-md-3" style="padding-left:0px;">
                                                <input type="submit" class="btn btn-default" id="search" value="Search" style="height:40px;" />
                                            </div>
                                        </div>
                                    </div>
                                </form>
                                <br /><hr />

                                <div id="map" class="map-wrapper content-group-sm"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

     <script type='text/javascript'>
        var DISPLAY_COUNT = 20;
        var myOptions = {};
        var markerArray = new Array();
        var map = null;
        //var geocoder = null;
        var marker = null;
        var g_ctr = 0;
        var last_used_address = "";
        var splitURLs = {};
        var global_markers = [];
        var infowindow = new google.maps.InfoWindow({});
        var geodata;
        var markers = [];

         initialize();
        function initialize() {

            myOptions = {
                center: new google.maps.LatLng(38.5111, -96.8005),
                zoom: 4,
                mapTypeId: google.maps.MapTypeId.HYBRID
            };
            map = new google.maps.Map(document.getElementById("map"), myOptions);

            //geocoder = new google.maps.Geocoder();
            @foreach (var item in Model)
            {
            <text>try
                {
                    var ip = '@item.Address';
                    var url = 'https://maps.googleapis.com/maps/api/js?key=11111111111111111111111111111111&ip=' + ip + '&callback=?';
                    $.getJSON(url,
                            function (data) {
                                if (data['statusCode'] == 'OK') {
                                    geodata = data;
                                    JSONString = JSON.stringify(geodata);
                                    //callback();
                                    //alert(data.regionName);
                                    var valuesToPush = new Array();
                                    valuesToPush[0] = data.lat;
                                    console.log(data.lat);
                                    valuesToPush[1] = data.lng;
                                    valuesToPush[2] = data.cityName + ', ' + data.regionName;
                                    valuesToPush[3] = data.ipAddress;
                                    markers.push(valuesToPush);
                                    addMarker();
                                }
                            });
                        }
            catch (err) { }</text>
            }
        }

        function addMarker() {
            for (var i = 0; i < markers.length; i++) {
                var lat = parseFloat(markers[i][0]);
                var lng = parseFloat(markers[i][1]);
                var cityState = markers[i][2];
                var ipAddress = markers[i][3];
                var myLatlng = new google.maps.LatLng(lat, lng);
                var contentString = '<div class="infowindow"><p>' + cityState + '<br/>' + ipAddress + '</p></div>';
                var marker = new google.maps.Marker({
                    position: myLatlng,
                    map: map,
                    title: "Coordinates: " + lat + " , " + lng + " \n Location: " + cityState
                });
                marker['infowindow'] = contentString;
                global_markers[i] = marker;
                google.maps.event.addListener(global_markers[i], 'click', function () {
                    infowindow.setContent(this['infowindow']);
                    infowindow.open(map, this);
                });
            }

        }
</script>
